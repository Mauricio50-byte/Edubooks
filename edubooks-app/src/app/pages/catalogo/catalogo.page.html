<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" text="" icon="arrow-back-outline"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <ion-icon name="library-outline"></ion-icon>
      <span class="title-text">Cat√°logo</span>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="limpiarFiltros()">
        <ion-icon name="refresh-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Barra de b√∫squeda -->
  <div class="search-container">
    <ion-searchbar 
      [(ngModel)]="searchQuery"
      (ionInput)="onSearchInput($event)"
      (ionClear)="limpiarFiltros()"
      placeholder="Buscar por t√≠tulo, autor, categor√≠a..."
      show-clear-button="focus"
      debounce="300">
    </ion-searchbar>
  </div>

  <!-- Filtros -->
  <div class="filters-container">
    <ion-row>
      <ion-col size="12" size-md="6">
        <ion-select 
          [(ngModel)]="categoriaSeleccionada"
          (ionChange)="onCategoriaChange($event)"
          placeholder="Seleccionar Categor√≠a"
          interface="action-sheet"
          class="category-select">
          <ion-select-option *ngFor="let categoria of categorias" [value]="categoria">
            {{ getCategoriaIcon(categoria) }} {{ categoria }}
          </ion-select-option>
        </ion-select>
      </ion-col>
      <ion-col size="12" size-md="6">
        <ion-select 
          [(ngModel)]="estadoSeleccionado"
          (ionChange)="onEstadoChange($event)"
          placeholder="Filtrar por Estado"
          interface="action-sheet"
          class="status-select">
          <ion-select-option value="Todos">üìã Todos los Estados</ion-select-option>
          <ion-select-option value="Disponible">‚úÖ Disponible</ion-select-option>
          <ion-select-option value="Prestado">üì§ Prestado</ion-select-option>
          <ion-select-option value="Reservado">üìù Reservado</ion-select-option>
          <ion-select-option value="Mantenimiento">üîß Mantenimiento</ion-select-option>
        </ion-select>
      </ion-col>
    </ion-row>
    
    <!-- Filtros r√°pidos por categor√≠a -->
    <div class="quick-filters">
      <ion-chip 
        [color]="categoriaSeleccionada === 'Todas' ? 'primary' : 'medium'"
        (click)="filtrarPorCategoria('Todas')">
        <ion-label>üìö Todas</ion-label>
      </ion-chip>
    </div>
  </div>

  <!-- Estado de carga -->
  <div class="loading-container" *ngIf="isLoading">
    <ion-spinner name="dots" color="primary"></ion-spinner>
    <p>Cargando libros...</p>
  </div>

  <!-- Mensaje cuando no hay resultados -->
  <div class="no-results" *ngIf="!isLoading && librosFiltrados.length === 0 && libros.length > 0">
    <ion-icon name="search-outline" color="medium" size="large"></ion-icon>
    <h3>No se encontraron resultados</h3>
    <p>Prueba con otros t√©rminos de b√∫squeda o filtros</p>
    <ion-button fill="outline" (click)="limpiarFiltros()">
      <ion-icon name="refresh-outline" slot="start"></ion-icon>
      Limpiar filtros
    </ion-button>
  </div>

  <!-- Lista de libros -->
  <div class="books-grid" *ngIf="!isLoading && librosFiltrados.length > 0">
    <ion-card *ngFor="let libro of librosFiltrados" class="book-card" (click)="verDetalle(libro)">
      <div class="book-image-container">
        <img [src]="libro.imagen_portada" [alt]="libro.titulo" class="book-image" 
              onerror="this.src='assets/images/book-placeholder.svg'">
        <ion-chip class="status-chip" [color]="getEstadoColor(libro.estado)">
          {{ libro.estado }}
        </ion-chip>
      </div>
      
      <ion-card-content>
        <h3 class="book-title">{{ libro.titulo }}</h3>
        <p class="book-author">{{ libro.autor }}</p>
        <p class="book-category">{{ libro.categoria }}</p>
        
        <div class="book-info">
          <ion-chip color="medium" size="small">
            <ion-icon name="location-outline"></ion-icon>
            <ion-label>{{ libro.ubicacion }}</ion-label>
          </ion-chip>
          
          <ion-chip color="tertiary" size="small">
            <ion-icon name="library-outline"></ion-icon>
            <ion-label>{{ libro.cantidad_disponible }}/{{ libro.cantidad_total }}</ion-label>
          </ion-chip>
        </div>
        
        <div class="book-actions">
          <ion-button 
            *ngIf="puedePrestar(libro)"
            expand="block" 
            fill="solid" 
            color="success"
            (click)="prestarLibro(libro); $event.stopPropagation()">
            <ion-icon name="download-outline" slot="start"></ion-icon>
            Prestar
          </ion-button>
          
          <ion-button 
            *ngIf="puedeReservar(libro)"
            expand="block" 
            fill="outline" 
            color="warning"
            (click)="reservarLibro(libro); $event.stopPropagation()">
            <ion-icon name="bookmark-outline" slot="start"></ion-icon>
            Reservar
          </ion-button>
          
          <ion-button 
            *ngIf="!puedePrestar(libro) && !puedeReservar(libro)"
            expand="block" 
            fill="outline" 
            color="medium"
            disabled>
            <ion-icon name="ban-outline" slot="start"></ion-icon>
            No disponible
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Mensaje inicial cuando no hay libros cargados -->
  <div class="empty-state" *ngIf="!isLoading && libros.length === 0">
    <ion-icon name="library-outline" color="medium" size="large"></ion-icon>
    <h3>No hay libros disponibles</h3>
    <p>El cat√°logo est√° vac√≠o en este momento</p>
  </div>
</ion-content>